<!doctype html>
<!--
  TODO
  cell onclick => display notes, parts for root, root-not, root-.+, .+-root-.*
  todo lists for each tab: untranslated nouns, untranslated toki pona, untranslated aUI
-->
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>few words</title>
<style>
  table {
    border-collapse: collapse;
    margin: auto;
  }
  td {
    padding: 2px 8px;
    text-align: center;
    border: 1px solid lightgrey;
  }
  tx {
    font-style: italic;
  }
</style>

<center>
<tx>word of few</tx>
<br>sound-thought-of-number-big-not
<br>few words
</center>

<p>Does oligosynthesis work better with concrete roots than abstract roots?
<br>Can a strict CV mono-syllable structure with a minimal phonemic inventory account for enough roots?
<br><button id="authorize_button">Authorize Google Sheets API</button>
<table id=syllables></table>

Simple intransitive sentences: subject <tx>[predicate]</tx> verb
<ul>
  <li>A person sees.
    <br><tx>person [predicate] see .</tx>
  <li>The ground is moving!
    <br><tx>earth [predicate] go !</tx>
</ul>

Simple transitive sentences: subject <tx>[predicate]</tx> verb <tx>[object]</tx> object
<ul>
  <li>A person sees something.
    <br><tx>person [predicate] see [object] thing .</tx>
  <li>The box contains a box.
    <br><tx>container [predicate] container [object] container .</tx>
</ul>

Imperative sentences leave off the subject: <tx>[predicate]</tx> verb
<ul>
  <li>Go!
    <br><tx>[predicate] go !</tx>
  <li>Breathe.
    <br><tx>[predicate] air .</tx>
</ul>

Context: clause <tx>[context]</tx> clause
<ul>
  <li>When the wind blows, the water moves.
    <br><tx>air [predicate] go [context] water [predicate] go .</tx>
  <li>If somebody eats it, they will not feel good.
    <br><tx>person [predicate] eat [object] thing [context] person [predicate] feel not [object] good .</tx>
</ul>

Nouns before adjectives.
<ul>
  <li>good earth
    <br><tx>earth good</tx>
  <li>wet air
    <br><tx>air water</tx>
</ul>

Verbs before adverbs.
<ul>
  <li>Eat well.
    <br><tx>[predicate] eat good .</tx>
  <li>Go fast.
    <br><tx>[predicate] go big .</tx>
</ul>

For foreign words, do the best you can, and trust that others will, too. Don't correct pronunciation or spelling unless requested.
<ul>
  <li>
    <br><tx></tx>
  <li>
    <br><tx></tx>
</ul>

Proper names work like adjectives.
<ul>
  <li>The Pacific Ocean moves little.
    <br><tx>water Pacific [predicate] go big not .</tx>
  <li>Antarctica is cold.
    <br><tx>earth Antactica [predicate] fire not .</tx>
</ul>

Yes/no questions: subject <tx>[predicate]</tx> verb <tx>not</tx> verb

<ul>
  <li>Is the dog hungry?
    <br><tx>animal [predicate] want not want [object] eat ?</tx>
  <li>Yes
    <br><tx>want .</tx>
</ul>

Specification questions use <tx>unknown</tx> as an adjective without changing the sentence order.

<ul>
  <li>Where is Charlie?
    <br><tx>person Charlie [predicate] where ?</tx>
  <li>Charlie is in the kitchen.
    <br><tx>person Charlie [predicate] in room food .</tx>
</ul>

Prepositions: <tx>[preposition]</tx> root [<tx>not</tx>]
<ul>
  <li>Go to the water.
    <br><tx>[predicate] go to water .</tx>
  <li>Go in the house.
    <br><tx>[predicate] go in room .</tx>
</ul>

Most words can be nouns, adjectives, verbs, and adverbs. Use context and your imagination.
<ul>
  <li><tx>person [predicate] want [object] food [context] [predicate] eat [object] food.</tx>
    <br>When hungry, eat.
  <li><tx>person [predicate] want [object] water [context] [predicate] eat [object] water.</tx>
    <br>When thirsty, drink.
</ul>

No pronouns. Instead of special words for I/me/myself/my/mine, say <tx>person</tx> then your name or some abbreviation. Unlike toki pona, no exception to using <tx>[predicate]</tx> for pronouns.
<ul>
  <li>
    <br><tx></tx>
  <li>
    <br><tx></tx>
</ul>

There is a complete number system:
<table id=nums></table>

Compare toki pona vocabulary
<div style="max-height: 19.5em; overflow: auto; margin: auto;">
  <table id=tokipona></table>
</div>

Compare aUI vocabulary
<div style="max-height: 19.5em; overflow: auto; margin: auto;">
  <table id=aui></table>
</div>

Transliterate
<div style="display: flex;">
  <textarea id=en style="flex-grow: 1;"></textarea>
  <textarea id=fw style="flex-grow: 1;"></textarea>
</div>

Full Vocabulary
<div style="max-height: 19.5em; overflow: auto; margin: auto;">
  <table id=words></table>
</div>

<script>
const spreadsheetId = '1lOF5iFM41Au5nf6oFgHLb7-kZQbtxVINLYktcYpjVsQ';
const F = {
  fw2en: {},
  en2fw: {},
  
  phrase(s, strict = false) {
    let fw = '';
    for (const en of s.split(' ')) {
      if (strict && !F.en2fw[en]) throw new Error(en);
      fw += ' ' + (F.en2fw[en] || en);
    }
    return fw;
  },

  transliterate() {
    for (const elem of document.querySelectorAll('tx')) {
      if (!elem.en) {
        elem.en = elem.innerText;
      }
      elem.innerText = F.phrase(elem.en);
    }
  },

  async load() {
    const response = await window.gapi.client.sheets.spreadsheets.get({
      spreadsheetId,
      includeGridData: true,
    });
    console.log(response);
    for (const sheet of response.result.sheets) {
      if (sheet.properties.title === 'syllables') {
    	  const table = document.getElementById('syllables');
        const strings = [];
        for (const row of sheet.data[0].rowData) {
          strings.push([]);
          const tr = document.createElement('tr');
          table.appendChild(tr);
          for (let coli = 0; coli < 6; ++coli) {
            const cell = row.values[coli] || {};
            const td = document.createElement('td');
            tr.appendChild(td);
            td.innerText = cell.formattedValue || '';
            strings[strings.length - 1].push(cell.formattedValue);
          }
        }
        for (let rowi = 1; rowi < strings.length; ++rowi) {
          for (let coli = 1; coli < strings[rowi].length; ++coli) {
            const en = strings[rowi][coli];
            if (!en) continue;
            const fw = strings[rowi][0] + strings[0][coli];
            F.fw2en[fw] = en;
            F.en2fw[en] = fw;
          }
        }
      } else if (sheet.properties.title === 'nouns') {
    	  const table = document.getElementById('words');
        const queue = [];
        for (const row of sheet.data[0].rowData) {
          const tr = document.createElement('tr');
          table.appendChild(tr);
          for (let coli = 0; coli < 2; ++coli) {
            const cell = row.values[coli] || {};
            const td = document.createElement('td');
            tr.appendChild(td);
            td.innerText = cell.formattedValue || '';
          }
          queue.push({en: row.values[0].formattedValue, elements: row.values[1].formattedValue});
          const td = document.createElement('td');
          tr.appendChild(td);
          const tx = document.createElement('tx');
          td.appendChild(tx);
          tx.innerText = row.values[1].formattedValue;
        }
        let prevLength = queue.length + 1;
        while (queue.length !== prevLength) {
          for (let i = 0; i < queue.length; ++i) {
            const {en, elements} = queue[i];
            try {
              const fw = F.phrase(elements, true);
              console.log(en, fw, elements);
              queue.splice(i, 1);
              --i;
              F.en2fw[en] = fw;
              F.fw2en[fw] = en;
            } catch (e) {
              console.log(en, elements, e);
            }
          }
          prevLength = queue.length;
        }
        if (queue.length) {
          console.log('unable to translate', queue);
        }
      } else if (sheet.properties.title === 'toki pona') {
    	  const table = document.getElementById('tokipona');
        for (const row of sheet.data[0].rowData) {
          const tr = document.createElement('tr');
          table.appendChild(tr);
          for (let coli = 0; coli < 2; ++coli) {
            const cell = row.values[coli] || {};
            const td = document.createElement('td');
            tr.appendChild(td);
            td.innerText = cell.formattedValue || '';
          }
          const td = document.createElement('td');
          tr.appendChild(td);
          const tx = document.createElement('tx');
          td.appendChild(tx);
          tx.innerText = row.values[1].formattedValue;
        }
      } else if (sheet.properties.title === 'aUI') {
    	  const table = document.getElementById('aui');
        for (const row of sheet.data[0].rowData) {
          const tr = document.createElement('tr');
          table.appendChild(tr);
          for (let coli = 0; coli < 3; ++coli) {
            const cell = row.values[coli] || {};
            const td = document.createElement('td');
            tr.appendChild(td);
            td.innerText = cell.formattedValue || '';
          }
          const td = document.createElement('td');
          tr.appendChild(td);
          const tx = document.createElement('tx');
          td.appendChild(tx);
          tx.innerText = (row.values[2] || {}).formattedValue || '';
        }
      } else {
        console.log(sheet);
      }
    }
    F.transliterate();
  },
};

addEventListener('load', () => {
  if (window.location.protocol === 'http:') {
    window.location.protocol = 'https:';
    return;
  }
  const script = document.createElement('script');
  script.async = 'async';
  script.defer = 'defer';
  script.src = 'https://apis.google.com/js/api.js';
  script.onreadystatechange = () => {
    if (this.readyState === 'complete') this.onload()
  };
  script.onload = () => {
    this.onload = function(){};
    window.gapi.load('client:auth2', function initClient() {
      window.gapi.client.init({
        clientId: '563656626445-ijrtluv6l4k9v8io4tinnl054onkmvaf.apps.googleusercontent.com',
        apiKey: 'AIzaSyCisRYYgsPjDE0DuiC2Wr8j7K8Mj2aFW-U',
        discoveryDocs: ['https://sheets.googleapis.com/$discovery/rest?version=v4'],
        scope: 'https://www.googleapis.com/auth/spreadsheets',
      }).then(async function () {
        updateSigninStatus();
        window.gapi.auth2.getAuthInstance().isSignedIn.listen(updateSigninStatus);
        document.getElementById('authorize_button').onclick = function handleAuthClick(event) {
          return window.gapi.auth2.getAuthInstance().signIn();
        };
      }, function(error) {
        document.body.innerText = JSON.stringify(error);
      });
    });
  };
  document.head.appendChild(script);
});

function updateSigninStatus() {
  if (window.gapi.auth2.getAuthInstance().isSignedIn.get()) {
    document.getElementById('authorize_button').style.display = 'none';
    F.load();
  } else {
    document.getElementById('authorize_button').style.display = 'block';
  }
}
</script>
